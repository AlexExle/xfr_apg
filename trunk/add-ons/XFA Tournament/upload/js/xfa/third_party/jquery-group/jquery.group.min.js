$(document).bind("XenForoActivationComplete",function(){!function(h,q,s,t){var A,E,i,r,f,p,n,m,v,z,k,x,D,C,c,e,g,j,w,d,y,b,B,a,l,o,u;d={win:3,tie:1,loss:0};e=function(F){return F-1+(F%2)};o=function(F){var G;if(!c.test(F)){return null}G=parseInt(F);if(isNaN(G)){return null}else{return G}};i=function(F){return h(F.currentTarget)};E=function(F){return[F,i(F)]};l=function(G,F){return G.findIndex(function(H){return H.id===F.id})};u=function(G){var F=z(G.participants,G.matches);return{teams:F.value(),matches:G.matches.map(function(H){return{a:{team:l(G.participants,H.a.team),score:(H.a.score!==null?H.a.score.toString():H.a.score)},b:{team:l(G.participants,H.b.team),score:(H.b.score!==null?H.b.score.toString():H.b.score)},round:H.round}}).value()}};z=function(F,G){return F.map(function(J){var K,L,M,I,H,N;L=G.filter(function(O){return O.a.score!==null&&O.b.score!==null}).filter(function(O){return O.a.team===J||O.b.team===J}).map(function(O){if(O.a.team===J){return{ownScore:O.a.score,opponentScore:O.b.score}}else{return{ownScore:O.b.score,opponentScore:O.a.score}}});I=L.reduce((function(P,O){return P+parseInt(O.ownScore)}),0);M=L.reduce((function(P,O){return P+parseInt(O.opponentScore)}),0);N=L.filter(function(O){return O.ownScore>O.opponentScore}).size();K=L.filter(function(O){return O.ownScore<O.opponentScore}).size();H=L.filter(function(O){return O.ownScore===O.opponentScore}).size();J.w=N;J.l=K;J.t=H;J.p=N*d.win+H*d.tie+K*d.loss;J.rW=I;J.rL=M;J.r=I-M;return{team:J}}).sortBy(function(H){return -H.team.r}).sortBy(function(H){return -H.team.p})};c=new RegExp(/^[0-9]+$/);b=' <td>{{team.p}}</td> <td>{{team.w}}</td> <td>{{team.l}}</td> <td>{{team.t}}</td> <td title="Won {{team.rW}}, lost {{team.rL}} bouts">{{team.r}}</td>';B=Handlebars.compile('<div class="standings"> <table> <colgroup> <col style="width: 50%"> <col span="5" style="width: 10%"> </colgroup> <tr><th></th><th>'+XenForo.phrases.xfa_tourn_points_abbrev+"</th><th>"+XenForo.phrases.xfa_tourn_wins_abbrev+"</th><th>"+XenForo.phrases.xfa_tourn_losses_abbrev+"</th><th>"+XenForo.phrases.xfa_tourn_ties_abbrev+'</th><th>&plusmn;</th></tr> {{#each this}} <tr data-teamid="{{team.id}}"><td>{{#if team.label}}{{team.label}}{{else}}{{team.name}}{{/if}}</td>'+b+"</tr> {{/each}} </table> </div>");y=B;g=Handlebars.compile('<div data-roundid="{{this}}" class="round"> {{#if this}} <header>'+XenForo.phrases.xfa_tourn_round+" {{this}}</header> {{else}} <header>Unassigned</header> {{/if}} </div>");D=Handlebars.compile('<div data-matchid="{{id}}" class="match" draggable="{{draggable}}"> <div class="team" data-teamid="{{a.team.id}}"> <div class="label">{{a.team.label}}</div> <div class="score {{homeClass}}">{{a.score}}</div> </div> <div class="team" data-teamid="{{b.team.id}}"> <div class="score {{awayClass}}">{{b.score}}</div> <div class="label">{{b.team.label}}</div> </div> </div>');k=Handlebars.compile('<div data-matchid="{{id}}" class="match" draggable="{{draggable}}"> <div class="team" data-teamid="{{a.team.id}}"> <div class="label">{{a.team.label}}</div> <input type="text" class="score home {{homeClass}}" value="{{a.score}}" /> </div> <div class="team" data-teamid="{{b.team.id}}"> <input type="text" class="score away {{awayClass}}" value="{{b.score}}" /> <div class="label">{{b.team.label}}</div> </div> </div>');x=function(F,H){var G,I;I=F.a.score>F.b.score;G={homeClass:I?"win":"lose",awayClass:I?"lose":"win"};return h(H(_.extend(G,F)))};j=Handlebars.compile('<header class="roundsHeader">Rounds</header>');w=Handlebars.compile('<div class="rounds"></div>');A=function(F){return F.name};m=0;r=function(){return ++m};v=0;f=function(){return ++v};n=function(F){return v=F.size()>0?F.max("id").value().id:0};a=function(G,F){return function(){var H;H=h(this).attr("data-teamid");return G.find("[data-teamid="+H+"]").toggleClass("highlight",F)}};p=function(T,L,ac,V,I){var P,S,K,R,O,W,F,X,Q,M,ab,H,G,U,N,aa,Y,Z,J;Z=function(ad){return T.find("[data-roundid='"+ad+"']")};R=function(ad){return T.find("[data-matchid='"+ad+"']")};if(V){T.addClass("read-write")}J=(function(){return{standings:function(af,aj,am,ag){var ah,ad,ae,al,an,ak,ai;ag=ag||_([]);if(!V){ah=h(B(ag.value()));ai=a.bind(null,T);ah.find("[data-teamid]").hover(ai(true),ai(false));return ah}ak=h(y(ag.value()));ad=ak.find("input[type=submit]");an=ak.find("input").asEventStream("keyup").map(i).map(function(ao){var aq,ap,ar;ar=ao.val();aq=ao.attr("data-prev");ap=ar.length>0&&(!ag.map(function(at){return at.team}).pluck("name").contains(ar)||aq===ar);return{el:ao,value:ar,valid:ap}}).toProperty();an.onValue(function(ao){ao.el.toggleClass("conflict",!ao.valid);if(ao.el.hasClass("add")){if(ao.valid){return ad.removeAttr("disabled")}else{return ad.attr("disabled","disabled")}}});al=an.map(function(ao){return ao.valid}).toProperty();ae=function(ao){return ak.find("input."+ao).asEventStream("change").filter(al).map(".target").map(h)};ae("name").onValue(function(ao){aj.push({id:parseInt(ao.attr("data-teamid")),to:ao.val()});return ao.attr("data-prev",ao.val())});ae("add").map(function(ao){return ao.val()}).onValue(function(ao){return af.push({id:f(),name:ao,format:"",data:{}})});ak.find("td.drop").asEventStream("click").map(".target").map(h).map(function(ao){return ao.attr("data-name")}).onValue(function(ao){return am.push(parseInt(ao))});return ak},roundsHeader:function(ae){var ad;ad=h(j());ad.asEventStream("click").onValue(function(){return ae.toggle()});return ad},rounds:h(w()),round:function(ad){return h(g(ad))},matchEdit:function(ad){return x(ad,k)},matchView:function(ad){return x(ad,D)}}})();K=(function(){return{create:function(ae,ad){return new function(){var af,ag;ag=J.round(ad);this.markup=ag;if(!V){return}af=0;ad=function(ah){return ag.asEventStream(ah).doAction(".preventDefault")};ad("dragover").onValue(function(ah){});ad("dragenter").map(i).onValue(function(ah){if(af===0){ah.addClass("over")}af++});ad("dragleave").map(i).onValue(function(ah){af--;if(af===0){ah.removeClass("over")}});ad("drop").map(E).onValues(function(ai,ah){var ak,aj;af=0;ak=ai.originalEvent.dataTransfer.getData("Text");aj=R(ak);ah.append(aj);ah.removeClass("over");ae.push({match:parseInt(ak),round:parseInt(ah.attr("data-roundId"))})})}}}})();S=(function(){return{create:function(ae,ad){return new function(){var ah,ag,af;ad=h.extend({},ad);ad.draggable=(V!=null).toString();if(!V){this.markup=J.matchView(ad);return}af=J.matchEdit(ad);this.markup=af;ag=function(ai){return af.find("input").asEventStream(ai)};ag("keyup").map(i).onValue(function(ai){return ai.toggleClass("conflict",o(ai.val())===null)});ag("change").onValue(function(){var aj,ai,ak;aj=o(af.find("input.home").val());ai=o(af.find("input.away").val());if(aj===null||ai===null){return}ak={a:{team:ad.a.team,score:aj},b:{team:ad.b.team,score:ai}};return ae.push(ak)});ah=function(ai){return function(aj){return af.asEventStream(ai).map(".originalEvent").map(E).onValues(aj)}};ah("dragstart")(function(aj,ai){aj.dataTransfer.setData("Text",ad.id);ai.css("opacity",0.5,"");return T.find(".round").addClass("droppable")});ah("dragend")(function(aj,ai){ai.removeAttr("style");return T.find(".droppable").removeClass("droppable")})}}}})();W=new Bacon.Bus();H=new Bacon.Bus();U=new Bacon.Bus();aa=new Bacon.Bus();F=new Bacon.Bus();G=new Bacon.Bus();O=W.toProperty({participants:_([]),matches:_([])});P=J.rounds.append(h(K.create(F,0).markup));T.append(J.standings(H)).append(P);X=O.sampledBy(H,function(ae,ag){var af,ad;if(ae.participants.size()>0){af=ae.participants.map(function(ah){return{id:r(),a:{team:ah,score:null},b:{team:ag,score:null},round:0}});ae.matches=ae.matches.union(af.value())}ag.label=new Handlebars.SafeString(I(ag));ae.participants.push(ag);ad=e(ae.participants.size());_(_.range(P.find(".round").length-1,ad)).each(function(ah){return P.append(K.create(F,ah+1).markup)});return ae});M=O.sampledBy(G,function(ae,af){var ad,ag,ah;ae.matches.filter(function(ai){return ai.a.team.id===af||ai.b.team.id===af}).map(function(ai){return ai.id}).forEach(function(ai){return R(ai).remove()});ah=e(ae.participants.size());ae.participants=ae.participants.filter(function(ai){return ai.id!==af});ag=e(ae.participants.size());ae.matches=ae.matches.filter(function(ai){return ai.a.team.id!==af&&ai.b.team.id!==af}).map(function(ai){if(ai.round>ag){ai.round=0}return ai});ad=Z(0);_(_.range(ag+1,ah+1)).each(function(ak){var ai,aj;aj=Z(ak);ai=aj.find(".match");ad.append(ai);return aj.remove()});return ae});Y=O.sampledBy(aa,function(ad,ae){ad.matches=ad.matches.map(function(af){if(af.a.team.id===ae.a.team.id&&af.b.team.id===ae.b.team.id){if(ae.round!==void 0){af.round=ae.round}af.a.score=ae.a.score;af.b.score=ae.b.score}else{if(af.a.team.id===ae.b.team.id&&af.b.team.id===ae.a.team.id){if(ae.round!==void 0){af.round=ae.round}af.a.score=ae.b.score;af.b.score=ae.a.score}}return af});return ad});ab=O.sampledBy(U,function(ad,ae){ad.participants=ad.participants.map(function(af){if(af.id===ae.id){af.name=ae.to;af.label=new Handlebars.SafeString(I(af))}return af});return ad});Q=O.sampledBy(F,function(ad,ae){ad.matches=ad.matches.map(function(af){if(af.id===ae.match){af.round=ae.round}return af});return ad});N=Bacon.mergeAll([X,Y,ab,M,Q]);N.throttle(10).onValue(function(ad){if(V){return V(u(ad))}});X.merge(Y).merge(M).throttle(10).onValue(function(ad){return T.find(".standings").replaceWith(J.standings(H,U,G,z(ad.participants,ad.matches),null))});ab.merge(X).merge(Y).throttle(10).onValue(function(af){var ae,ad,ag;ad=af.matches.filter((function(ah){return ah.round}));ag=af.matches.filter((function(ah){return !ah.round}));ad.each(function(aj){var ah,ai;ah=R(aj.id);ai=S.create(aa,aj).markup;if(ah.length){return ah.replaceWith(ai)}else{return Z(aj.round).append(ai)}});if(ag.size()>0||V){ae=Z(0);return ag.each(function(aj){var ah,ai;ah=R(aj.id);ai=S.create(aa,aj).markup;if(ah.length){return ah.replaceWith(ai)}else{return ae.append(ai)}})}});L.each(function(ad){return H.push(ad)});return ac.each(function(ad){return aa.push(ad)})};C={init:function(I){var F,H,J,G;I=I||{};H=I.labeler||A;F=this;G=_();J=_();if(I.init){G=_(I.init.teams);J=_(I.init.matches).map(function(K){K.a.team=I.init.teams[K.a.team];K.b.team=I.init.teams[K.b.team];return K})}n(G);return p(h('<div class="jqgroup"></div>').appendTo(F),G,J,I.save||null,H)}};return h.fn.group=function(F){if(C[F]){return C[F].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof F==="object"||!F){return C.init.apply(this,arguments)}else{return h.error("Method "+F+" does not exist on jQuery.group")}}}}(jQuery,this,document)});